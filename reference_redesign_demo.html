<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reference UI Redesign - 10 Alternative Layouts</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Outfit:wght@500;700;900&display=swap"
        rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }

        .outfit {
            font-family: 'Outfit', sans-serif;
        }

        .glass {
            background: rgba(255, 255, 255, 0.7);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }

        .no-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }

        .layout-card {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .selection-indicator {
            transition: all 0.3s ease;
        }

        .connector-line {
            stroke: #6366f1;
            stroke-width: 2;
            fill: none;
            opacity: 0.3;
            transition: opacity 0.3s;
        }

        .connector-line.active {
            opacity: 1;
            stroke-width: 3;
        }

        @keyframes float {
            0% {
                transform: translateY(0px);
            }

            50% {
                transform: translateY(-5px);
            }

            100% {
                transform: translateY(0px);
            }
        }

        .animate-float {
            animation: float 3s ease-in-out infinite;
        }
    </style>
</head>

<body class="bg-slate-50 text-slate-900 overflow-hidden h-screen flex">

    <!-- Sidebar -->
    <aside class="w-80 h-full bg-slate-900 text-white flex flex-col shrink-0">
        <div class="p-6 border-b border-slate-800">
            <div class="flex items-center gap-3 mb-2">
                <div class="bg-indigo-600 p-2 rounded-lg text-white">
                    <i data-lucide="link-2" class="w-6 h-6"></i>
                </div>
                <h1 class="text-xl font-bold outfit uppercase tracking-tight">REF.DESIGN</h1>
            </div>
            <p class="text-xs text-slate-400 font-medium">10 Dynamic Reference Layouts</p>
        </div>

        <nav class="flex-1 overflow-y-auto p-4 space-y-2 no-scrollbar" id="layout-nav">
            <!-- Navigation links will be injected by JS -->
        </nav>

        <div class="p-4 border-t border-slate-800">
            <div class="bg-slate-800/50 rounded-xl p-4 border border-slate-700">
                <p class="text-[10px] font-bold text-slate-500 uppercase tracking-widest mb-1">Status</p>
                <div class="flex items-center gap-2">
                    <span class="w-2 h-2 bg-emerald-500 rounded-full animate-pulse"></span>
                    <span class="text-sm font-medium text-slate-300">Standalone Prototype</span>
                </div>
            </div>
        </div>
    </aside>

    <!-- Main Content -->
    <main class="flex-1 flex flex-col min-w-0 bg-slate-50 relative">
        <!-- Explorer Header -->
        <header class="h-20 bg-white border-b border-slate-200 px-8 flex items-center justify-between z-20">
            <div>
                <h2 id="current-layout-name" class="text-2xl font-black text-slate-900 outfit leading-none mb-1">Twin
                    Pillar Connect</h2>
                <p id="current-layout-desc" class="text-sm text-slate-500 font-medium">Visualizing direct links with
                    interactive connectors.</p>
            </div>
            <div class="flex items-center gap-4">
                <div class="flex p-1 bg-slate-100 rounded-lg">
                    <button
                        class="px-3 py-1.5 text-xs font-bold bg-white text-slate-900 rounded-md shadow-sm border border-slate-200">Light</button>
                    <button class="px-3 py-1.5 text-xs font-bold text-slate-500 hover:text-slate-700">Dark</button>
                </div>
                <div class="h-8 w-px bg-slate-200"></div>
                <button
                    class="bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-2 rounded-lg text-sm font-bold transition-colors">Apply
                    Design</button>
            </div>
        </header>

        <!-- Dynamic Content Area -->
        <section id="demo-viewport" class="flex-1 overflow-hidden relative p-8">
            <!-- Layouts will be injected here -->
        </section>

        <!-- Global Filters / Stats Floating Bar -->
        <div id="global-stats-bar"
            class="absolute bottom-8 left-1/2 -translate-x-1/2 glass rounded-full px-6 py-3 shadow-2xl border border-indigo-100 flex items-center gap-8 z-30 transition-all duration-500">
            <div class="flex items-center gap-3">
                <span class="p-1.5 bg-indigo-50 text-indigo-600 rounded-lg"><i data-lucide="layers"
                        class="w-4 h-4"></i></span>
                <div>
                    <span class="text-[10px] font-black uppercase text-slate-400 block -mb-0.5">Total</span>
                    <span class="text-sm font-bold text-slate-900">12 References</span>
                </div>
            </div>
            <div class="w-px h-6 bg-slate-200"></div>
            <div class="flex items-center gap-3">
                <span class="p-1.5 bg-emerald-50 text-emerald-600 rounded-lg"><i data-lucide="check-circle"
                        class="w-4 h-4"></i></span>
                <div>
                    <span class="text-[10px] font-black uppercase text-slate-400 block -mb-0.5">Valid</span>
                    <span class="text-sm font-bold text-slate-900">10 Files</span>
                </div>
            </div>
            <div class="w-px h-6 bg-slate-200"></div>
            <div class="flex items-center gap-3">
                <span class="p-1.5 bg-red-50 text-red-600 rounded-lg"><i data-lucide="alert-circle"
                        class="w-4 h-4"></i></span>
                <div>
                    <span class="text-[10px] font-black uppercase text-slate-400 block -mb-0.5">Invalid</span>
                    <span class="text-sm font-bold text-slate-900">2 Risks</span>
                </div>
            </div>
        </div>
    </main>

    <div id="interaction-guide"
        class="fixed top-24 right-8 w-64 glass rounded-2xl p-4 z-40 shadow-xl border border-indigo-100 transition-all duration-300 opacity-0 translate-x-10">
        <div class="flex items-center gap-2 mb-2 text-indigo-600">
            <i data-lucide="info" class="w-4 h-4"></i>
            <span class="text-xs font-black uppercase tracking-widest">Interactivity Guide</span>
        </div>
        <p id="guide-text" class="text-[11px] text-slate-600 font-medium leading-relaxed">
            Click any section on the left to see its targets.
        </p>
    </div>

    <!-- Verbatim Modal -->
    <div id="verbatim-modal"
        class="fixed inset-0 bg-slate-900/40 backdrop-blur-sm z-[100] hidden items-center justify-center p-8 animate-in fade-in duration-300">
        <div
            class="bg-white rounded-[2.5rem] w-full max-w-5xl h-[600px] shadow-2xl border border-slate-200 flex flex-col overflow-hidden animate-in zoom-in-95 duration-300">
            <div class="p-8 border-b border-slate-100 flex items-center justify-between bg-slate-50/50">
                <div class="flex items-center gap-4">
                    <div
                        class="w-12 h-12 rounded-2xl bg-indigo-600 flex items-center justify-center shadow-lg shadow-indigo-100">
                        <i data-lucide="search" class="w-6 h-6 text-white"></i>
                    </div>
                    <div>
                        <h2 class="text-xl font-bold text-slate-900 outfit">Verbatim Verification</h2>
                        <p class="text-[10px] font-black uppercase text-slate-400 tracking-widest mt-1">Side-by-side
                            snippet comparison</p>
                    </div>
                </div>
                <button onclick="closeVerbatimModal()"
                    class="w-12 h-12 rounded-2xl hover:bg-slate-100 flex items-center justify-center text-slate-400 transition-colors">
                    <i data-lucide="x" class="w-6 h-6"></i>
                </button>
                <div class="flex-1 p-8 overflow-hidden" id="modal-body">
                    <!-- Content injected via JS -->
                </div>
                <div class="p-6 border-t border-slate-100 bg-slate-50 flex justify-end">
                    <button onclick="closeVerbatimModal()"
                        class="px-8 py-3 bg-slate-900 text-white rounded-2xl font-bold outfit uppercase text-xs tracking-widest hover:bg-slate-800 transition-colors shadow-lg shadow-slate-200">
                        Done Reviewing
                    </button>
                </div>
            </div>
        </div>

        <script>
            // --- MOCK DATA ---
            const references = [
                { id: 'r1', s_head: 'Section 4.1', t_head: 'Section 12.2', status: 'valid', area: 'Legal', s_text: 'Liability is capped at 100k per occurrence.', t_text: 'The indemnity shall not exceed the liability cap in 4.1.', reason: '' },
                { id: 'r2', s_head: 'Section 4.1', t_head: 'Section 3.1', status: 'invalid', area: 'Legal', s_text: 'Governing law is defined in Section 3.1.', t_text: 'Section 3.1 was removed in Amendment 4.', reason: 'Target Section Deleted' },
                { id: 'r3', s_head: 'Section 12.5', t_head: 'Section 12.5', status: 'self', area: 'Finance', s_text: 'This clause is self-contained and does not refer back.', t_text: 'Same as source.', reason: '' },
                { id: 'r4', s_head: 'Section 6.8', t_head: 'Section 1', status: 'valid', area: 'Compliance', s_text: 'Definitions are inherited from Section 1.', t_text: 'Section 1: General provisions and definitions.', reason: '' },
                { id: 'r5', s_head: 'Section 1.1', t_head: 'Section 1', status: 'self', area: 'Compliance', s_text: 'Part of the preamble definitions block.', t_text: 'Same as source.', reason: '' },
                { id: 'r6', s_head: 'Section 2.3', t_head: 'Section 4.1', status: 'valid', area: 'Finance', s_text: 'Payment terms are subject to liability caps in 4.1.', t_text: 'Section 4.1: Operational Liability Limitations.', reason: '' },
                { id: 'r7', s_head: 'Section 8.2', t_head: 'Section 9.0', status: 'invalid', area: 'Legal', s_text: 'Refer to Section 9.0 for termination rights.', t_text: 'Section 9.0: This section is intentionally left blank.', reason: 'Circular Reference / Empty Section' },
                { id: 'r8', s_head: 'Section 4.1', t_head: 'Section 12.5', status: 'valid', area: 'Finance', s_text: 'Audit rights defined in 12.5 apply here.', t_text: 'Section 12.5: Information Security and Audit.', reason: '' },
                { id: 'r9', s_head: 'Section 5.0', t_head: 'Section 5.0', status: 'self', area: 'Legal', s_text: 'Standard boilerplate notice clause.', t_text: 'Same as source.', reason: '' },
                { id: 'r10', s_head: 'Section 15', t_head: 'Section 4.1', status: 'valid', area: 'Compliance', s_text: 'Environmental compliance follows 4.1 caps.', t_text: 'Section 4.1: General Limitations.', reason: '' }
            ];

            const layouts = [
                { id: 'twin-pillar', num: 1, name: 'Twin Pillar Connect', icon: 'filter', desc: 'Mutual filtering with integrated detail cards.', guide: 'Click a Source to see ONLY related Targets, or click a Target to see ONLY related Sources. Selected items expand to show verbatim details.' },
                { id: 'master-detail', num: 2, name: 'Master-Detail Aligned', icon: 'layout', desc: 'Compact list with context-rich detail pane.', guide: 'Click any item in the left list to load its full context and validation reason in the right pane. This layout follows the "Key Terms" design system.' },
                { id: 'pivot-matrix', num: 3, name: 'Pivot Matrix', icon: 'grid', desc: 'Dense relationship grid for complex overlap.', guide: 'Click on any numbered cell in the grid to filter and view the specific relationship between that Source and Target.' },
                { id: 'accordion-density', num: 4, name: 'Density Accordion', icon: 'rows', desc: 'Grouped by section for doc flow tracking.', guide: 'Click on a section header to expand/collapse the references found within that specific document part.' },
                { id: 'pill-stream', num: 5, name: 'Pill Stream', icon: 'list', desc: 'Minimalist tag-based navigation.', guide: 'Hover over or click a pill to highlight its relationship and view status indicators.' },
                { id: 'drill-cards', num: 6, name: 'Drill-through Cards', icon: 'layers', desc: 'Individually addressable master-detail cards.', guide: 'Click on a card to "drill down" into the specific evidence and validation metadata.' },
                { id: 'nexus-ribbon', num: 7, name: 'Nexus Ribbon', icon: 'git-merge', desc: 'Visual flow between two collections.', guide: 'Interactive nodes on either side can be clicked to trace the flow of data through the central nexus.' },
                { id: 'node-graph', num: 8, name: 'Relationship Graph', icon: 'share-2', desc: 'Visualizing hotspots and document dependencies.', guide: 'Nodes represent sections. Hover to see connections; click to lock the view onto a specific node cluster.' },
                { id: 'interleaved', num: 9, name: 'Interleaved Context', icon: 'file-text', desc: 'Simultaneous view of source/target snippets.', guide: 'Scroll through the interleaved view. Click "View Original" on any snippet to jump to the full document context.' },
                { id: 'command-palette', num: 10, name: 'Command Finder', icon: 'search', desc: 'Rapid search/filter for large reference sets.', guide: 'Type in the search bar to filter references dynamically. Use arrow keys + Enter to select (simulated).' }
            ];

            // --- STATE ---
            let activeLayout = 'twin-pillar';
            let selectedSource = null;
            let selectedTarget = null;
            let selectedRefId = null;

            let statusFilter = 'ALL'; // ALL, VALID, INVALID, SELF-REF
            let sourceSearch = '';
            let targetSearch = '';

            // --- CORE FUNCTIONS ---
            function init() {
                renderNav();
                switchLayout('twin-pillar');
                lucide.createIcons();
                window.addEventListener('resize', () => { if (activeLayout === 'twin-pillar') drawConnectors(); });

                // Show guide after a short delay
                setTimeout(() => {
                    const guide = document.getElementById('interaction-guide');
                    guide.classList.remove('opacity-0', 'translate-x-10');
                }, 1000);
            }

            function openVerbatimModal(refId) {
                const r = references.find(ref => ref.id === refId);
                const modal = document.getElementById('verbatim-modal');
                const content = document.getElementById('modal-body');

                content.innerHTML = `
                <div class="grid grid-cols-2 gap-8 h-full">
                    <div class="flex flex-col h-full bg-slate-50 rounded-2xl p-6 border border-slate-200">
                        <div class="flex items-center gap-2 mb-4">
                            <span class="px-2 py-0.5 bg-indigo-100 text-indigo-700 text-[10px] font-black rounded uppercase tracking-tighter">SOURCE: ${r.s_head}</span>
                        </div>
                        <div class="flex-1 overflow-y-auto font-serif text-slate-800 leading-relaxed text-sm p-4 bg-white rounded-xl border border-dashed border-slate-300">
                            <span class="bg-indigo-50 border-b-2 border-indigo-400 font-bold">"${r.s_text}"</span>
                        </div>
                    </div>
                    <div class="flex flex-col h-full bg-slate-50 rounded-2xl p-6 border border-slate-200">
                        <div class="flex items-center gap-2 mb-4">
                            <span class="px-2 py-0.5 ${r.status === 'valid' ? 'bg-emerald-100 text-emerald-700' : 'bg-red-100 text-red-700'} text-[10px] font-black rounded uppercase tracking-tighter">TARGET: ${r.t_head}</span>
                            ${r.status === 'invalid' ? `<span class="text-[8px] font-black text-red-500 uppercase">${r.reason}</span>` : ''}
                        </div>
                        <div class="flex-1 overflow-y-auto font-serif text-slate-500 leading-relaxed text-sm p-4 bg-white rounded-xl border border-dashed border-slate-300">
                            <span class="bg-yellow-50 border-b-2 border-yellow-400 text-slate-800 font-bold">"${r.t_text}"</span>
                        </div>
                    </div>
                </div>
            `;

                modal.classList.remove('hidden');
                modal.classList.add('flex');
                lucide.createIcons();
            }

            function closeVerbatimModal() {
                const modal = document.getElementById('verbatim-modal');
                modal.classList.add('hidden');
                modal.classList.remove('flex');
            }

            function renderNav() {
                const nav = document.getElementById('layout-nav');
                nav.innerHTML = layouts.map(l => `
                <button onclick="switchLayout('${l.id}')" id="nav-${l.id}"
                    class="w-full flex items-center gap-3 px-4 py-3 rounded-xl transition-all group ${activeLayout === l.id ? 'bg-indigo-600 text-white shadow-lg' : 'text-slate-400 hover:bg-slate-800 hover:text-white'}">
                    <span class="text-[10px] font-black w-5 h-5 flex items-center justify-center rounded-full ${activeLayout === l.id ? 'bg-white/20' : 'bg-slate-800'}">${l.num}</span>
                    <i data-lucide="${l.icon}" class="w-4 h-4"></i>
                    <span class="text-sm font-bold truncate">${l.name}</span>
                </button>
            `).join('');
                lucide.createIcons();
            }

            function switchLayout(id) {
                activeLayout = id;
                selectedSource = null;
                selectedTarget = null;
                selectedRefId = null;

                document.querySelectorAll('#layout-nav button').forEach(b => {
                    b.classList.remove('bg-indigo-600', 'text-white', 'shadow-lg');
                    b.classList.add('text-slate-400', 'hover:bg-slate-800', 'hover:text-white');
                });
                const activeBtn = document.getElementById(`nav-${id}`);
                activeBtn.classList.remove('text-slate-400', 'hover:bg-slate-800', 'hover:text-white');
                activeBtn.classList.add('bg-indigo-600', 'text-white', 'shadow-lg');

                const layoutData = layouts.find(l => l.id === id);
                document.getElementById('current-layout-name').innerText = `${layoutData.num}. ${layoutData.name}`;
                document.getElementById('current-layout-desc').innerText = layoutData.desc;
                document.getElementById('guide-text').innerText = layoutData.guide;

                renderLayout();
            }

            function renderLayout() {
                const viewport = document.getElementById('demo-viewport');
                viewport.innerHTML = '';

                switch (activeLayout) {
                    case 'twin-pillar': renderTwinPillar(viewport); break;
                    case 'nexus-ribbon': renderNexusRibbon(viewport); break;
                    case 'accordion-density': renderAccordionDensity(viewport); break;
                    case 'pivot-matrix': renderPivotMatrix(viewport); break;
                    case 'pill-stream': renderPillStream(viewport); break;
                    case 'drill-cards': renderDrillCards(viewport); break;
                    case 'node-graph': renderNodeGraph(viewport); break;
                    case 'master-detail': renderMasterDetail(viewport); break;
                    case 'interleaved': renderInterleaved(viewport); break;
                    case 'command-palette': renderCommandPalette(viewport); break;
                }
                lucide.createIcons();
            }

            // --- SELECTION LOGIC ---
            function selectSource(header) {
                if (header === selectedSource) selectedSource = null;
                else {
                    selectedSource = header;
                    selectedTarget = null;
                }
                renderLayout();
            }

            function selectTarget(header) {
                if (header === selectedTarget) selectedTarget = null;
                else {
                    selectedTarget = header;
                    selectedSource = null;
                }
                renderLayout();
            }

            function selectRef(id) {
                selectedRefId = id;
                renderLayout();
            }

            // --- LAYOUTS ---

            function renderTwinPillar(container) {
                // Apply L3: Status Global Filter
                const filteredRefs = references.filter(r =>
                    statusFilter === 'ALL' ||
                    (statusFilter === 'VALID' && r.status === 'valid') ||
                    (statusFilter === 'INVALID' && r.status === 'invalid') ||
                    (statusFilter === 'SELF-REF' && r.status === 'self')
                );

                // Determine display lists (applying L4: Section Search)
                let displaySources = Array.from(new Set(filteredRefs.map(r => r.s_head)))
                    .filter(s => s.toLowerCase().includes(sourceSearch.toLowerCase()));
                let displayTargets = Array.from(new Set(filteredRefs.map(r => r.t_head)))
                    .filter(t => t.toLowerCase().includes(targetSearch.toLowerCase()));

                if (selectedSource) {
                    displayTargets = Array.from(new Set(filteredRefs.filter(r => r.s_head === selectedSource).map(r => r.t_head)));
                } else if (selectedTarget) {
                    displaySources = Array.from(new Set(filteredRefs.filter(r => r.t_head === selectedTarget).map(r => r.s_head)));
                }

                container.innerHTML = `
                <div class="flex flex-col h-full overflow-hidden">
                    <!-- L3: Status Filter Bar -->
                    <div class="flex items-center gap-4 mb-6 bg-white p-2 rounded-2xl border border-slate-200 shadow-sm w-fit mx-auto">
                        ${['ALL', 'VALID', 'INVALID', 'SELF-REF'].map(f => `
                            <button onclick="statusFilter = '${f}'; renderLayout()" 
                                class="px-6 py-2 rounded-xl text-[10px] font-black uppercase tracking-widest transition-all ${statusFilter === f ? 'bg-indigo-600 text-white shadow-lg' : 'text-slate-400 hover:bg-slate-50'}">
                                ${f}
                            </button>
                        `).join('')}
                    </div>

                    <div class="flex flex-1 gap-12 overflow-hidden bg-slate-50/50 rounded-3xl border border-slate-100 shadow-inner p-4">
                        <!-- Source Column -->
                        <div class="flex-1 flex flex-col gap-4 overflow-y-auto no-scrollbar py-2 px-2" id="source-col">
                            <div class="bg-slate-50/50 backdrop-blur-md sticky top-0 z-20 pb-4">
                                <div class="flex items-center justify-between mb-3 px-2">
                                    <h4 class="text-[10px] font-black uppercase tracking-widest text-slate-400">Source Sections</h4>
                                    ${selectedTarget ? `<span class="text-[9px] font-bold text-indigo-600 bg-indigo-50 px-2 py-0.5 rounded-full">Viewing Refs to ${selectedTarget}</span>` : ''}
                                </div>
                                <!-- L4: Section Search -->
                                <div class="relative group">
                                    <i data-lucide="search" class="absolute left-3 top-1/2 -translate-y-1/2 w-3 h-3 text-slate-300 group-focus-within:text-indigo-500 transition-colors"></i>
                                    <input type="text" placeholder="Search sections..." value="${sourceSearch}"
                                           oninput="sourceSearch = this.value; renderLayout()"
                                           class="w-full bg-white border border-slate-200 rounded-xl py-2 pl-9 pr-4 text-xs font-medium focus:ring-2 focus:ring-indigo-500/10 focus:border-indigo-500 transition-all">
                                </div>
                            </div>

                            ${displaySources.map(s => {
                    const isSelected = selectedSource === s;
                    // In the Source column, we expand if Target is selected (to show relationship) 
                    // OR if this is the focal selected source (to show its own metadata, but NO redundant child list)
                    const isContextuallyExpanded = selectedTarget !== null;
                    const refsForThisSelection = selectedTarget ? filteredRefs.filter(r => r.s_head === s && r.t_head === selectedTarget) : [];

                    return `
                                    <div onclick="selectSource('${s}')" 
                                         class="rounded-2xl transition-all cursor-pointer group shadow-sm border-2 ${isSelected ? 'bg-indigo-50 border-indigo-600 shadow-indigo-100 z-10' : 'bg-white border-white hover:border-slate-200'}">
                                        <div class="p-4">
                                            <div class="flex justify-between items-center mb-1">
                                                <span class="text-xs font-black uppercase outfit ${isSelected ? 'text-indigo-700' : 'text-slate-900'}">${s}</span>
                                                ${isSelected ? '<i data-lucide="check-circle-2" class="w-4 h-4 text-indigo-600"></i>' : (isContextuallyExpanded ? '<i data-lucide="chevron-down" class="w-4 h-4 text-indigo-400"></i>' : '<i data-lucide="chevron-right" class="w-4 h-4 text-slate-300 group-hover:text-slate-400"></i>')}
                                            </div>
                                            <p class="text-[10px] font-medium text-slate-400">${isSelected ? 'Currently Focused' : `Flows to ${selectedTarget || 'Targets'}`}</p>
                                        </div>
                                        
                                        ${isContextuallyExpanded ? `
                                            <div class="px-4 pb-4 pt-2 border-t border-indigo-100 bg-white/50 rounded-b-2xl animate-in fade-in slide-in-from-top-2 duration-300">
                                                <div class="space-y-3">
                                                    ${refsForThisSelection.map(r => `
                                                        <div class="p-3 bg-white rounded-xl border border-slate-100 shadow-sm relative group/ref">
                                                            <div class="flex items-center justify-between mb-2">
                                                                <div class="flex items-center gap-2">
                                                                    <span class="w-1.5 h-1.5 rounded-full ${r.status === 'valid' ? 'bg-emerald-500' : r.status === 'self' ? 'bg-indigo-400' : 'bg-red-500'}"></span>
                                                                    <span class="text-[8px] font-black text-slate-400 uppercase tracking-widest leading-none">${r.area} Reference</span>
                                                                </div>
                                                                <!-- L5: Verbatim Trigger -->
                                                                <button onclick="event.stopPropagation(); openVerbatimModal('${r.id}')" 
                                                                        class="p-1.5 rounded-lg bg-slate-50 text-slate-400 hover:bg-indigo-600 hover:text-white transition-all shadow-sm">
                                                                    <i data-lucide="zoom-in" class="w-3 h-3"></i>
                                                                </button>
                                                            </div>
                                                            <p class="text-[11px] text-slate-600 font-medium leading-relaxed italic line-clamp-2">"${r.s_text}"</p>
                                                        </div>
                                                    `).join('')}
                                                </div>
                                            </div>
                                        ` : ''}
                                    </div>
                                `;
                }).join('')}
                        </div>

                        <!-- Divider -->
                        <div class="w-px h-full bg-slate-200 relative flex items-center justify-center">
                            <div class="p-2 bg-white rounded-full border border-slate-200 text-slate-300 shadow-sm">
                                <i data-lucide="link" class="w-4 h-4"></i>
                            </div>
                        </div>

                        <!-- Target Column -->
                        <div class="flex-1 flex flex-col gap-4 overflow-y-auto no-scrollbar py-2 px-2" id="target-col">
                            <div class="bg-slate-50/50 backdrop-blur-md sticky top-0 z-20 pb-4">
                                <div class="flex items-center justify-between mb-3 px-2 flex-row-reverse">
                                    <h4 class="text-[10px] font-black uppercase tracking-widest text-slate-400">Target Sections</h4>
                                    ${selectedSource ? `<span class="text-[9px] font-bold text-indigo-600 bg-indigo-50 px-2 py-0.5 rounded-full text-right">Viewing Refs from ${selectedSource}</span>` : ''}
                                </div>
                                <!-- L4: Section Search -->
                                <div class="relative group">
                                    <i data-lucide="search" class="absolute left-3 top-1/2 -translate-y-1/2 w-3 h-3 text-slate-300 group-focus-within:text-indigo-500 transition-colors"></i>
                                    <input type="text" placeholder="Search sections..." value="${targetSearch}"
                                           oninput="targetSearch = this.value; renderLayout()"
                                           class="w-full bg-white border border-slate-200 rounded-xl py-2 pl-9 pr-4 text-xs font-medium focus:ring-2 focus:ring-indigo-500/10 focus:border-indigo-500 transition-all text-right">
                                </div>
                            </div>

                            ${displayTargets.map(t => {
                    const isSelected = selectedTarget === t;
                    // In the Target column, we expand if Source is selected (to show relationship)
                    const isContextuallyExpanded = selectedSource !== null;
                    const refsForThisSelection = selectedSource ? filteredRefs.filter(r => r.t_head === t && r.s_head === selectedSource) : [];

                    return `
                                    <div onclick="selectTarget('${t}')" 
                                         class="rounded-2xl transition-all cursor-pointer group shadow-sm border-2 ${isSelected ? 'bg-indigo-50 border-indigo-600 shadow-indigo-100 z-10' : 'bg-white border-white hover:border-slate-200'}">
                                        <div class="p-4">
                                            <div class="flex justify-between items-center mb-1 flex-row-reverse">
                                                <span class="text-xs font-black uppercase outfit ${isSelected ? 'text-indigo-700' : 'text-slate-900'}">${t}</span>
                                                ${isSelected ? '<i data-lucide="check-circle-2" class="w-4 h-4 text-indigo-600"></i>' : (isContextuallyExpanded ? '<i data-lucide="chevron-down" class="w-4 h-4 text-indigo-400"></i>' : '<i data-lucide="chevron-right" class="w-4 h-4 text-slate-300 group-hover:text-slate-400"></i>')}
                                            </div>
                                            <p class="text-[10px] font-medium text-slate-400 text-right">${isSelected ? 'Currently Focused' : `Referred by ${selectedSource || 'Sources'}`}</p>
                                        </div>

                                        ${isContextuallyExpanded ? `
                                            <div class="px-4 pb-4 pt-2 border-t border-indigo-100 bg-white/50 rounded-b-2xl animate-in fade-in slide-in-from-top-2 duration-300">
                                                <div class="space-y-3">
                                                    ${refsForThisSelection.map(r => `
                                                        <div class="p-3 bg-white rounded-xl border border-slate-100 shadow-sm relative group/ref">
                                                            <div class="flex items-center justify-between mb-2">
                                                                <div class="flex items-center gap-2">
                                                                    <span class="w-1.5 h-1.5 rounded-full ${r.status === 'valid' ? 'bg-emerald-500' : r.status === 'self' ? 'bg-indigo-400' : 'bg-red-500'}"></span>
                                                                    <span class="text-[8px] font-black text-slate-400 uppercase tracking-widest leading-none">${r.area} Reference</span>
                                                                </div>
                                                                <!-- L5: Verbatim Trigger -->
                                                                <button onclick="event.stopPropagation(); openVerbatimModal('${r.id}')" 
                                                                        class="p-1.5 rounded-lg bg-slate-50 text-slate-400 hover:bg-indigo-600 hover:text-white transition-all shadow-sm">
                                                                    <i data-lucide="zoom-in" class="w-3 h-3"></i>
                                                                </button>
                                                            </div>
                                                            <p class="text-[11px] text-slate-600 font-medium leading-relaxed italic line-clamp-2">"${r.s_text}"</p>
                                                            ${r.status === 'invalid' ? `<p class="mt-2 text-[8px] font-black text-red-500 uppercase tracking-widest flex items-center gap-1"><i data-lucide="alert-triangle" class="w-2 h-2"></i> ${r.reason}</p>` : ''}
                                                        </div>
                                                    `).join('')}
                                                </div>
                                            </div>
                                        ` : ''}
                                    </div>
                                `;
                }).join('')}
                        </div>
                    </div>
                </div>
            `;
                lucide.createIcons();
            }

            function renderMasterDetail(container) {
                const currentRef = references.find(r => r.id === selectedRefId) || references[0];
                container.innerHTML = `
                <div class="flex h-full bg-white rounded-2xl border border-slate-200 shadow-xl overflow-hidden">
                    <div class="w-80 border-r border-slate-100 flex flex-col overflow-hidden bg-slate-50/30">
                        <div class="p-4 border-b border-slate-100 flex items-center justify-between">
                            <span class="text-[10px] font-black uppercase text-slate-400">Reference List</span>
                            <div class="flex gap-1">
                                <span class="w-1.5 h-1.5 bg-emerald-500 rounded-full"></span>
                                <span class="w-1.5 h-1.5 bg-red-500 rounded-full"></span>
                            </div>
                        </div>
                        <div class="flex-1 overflow-y-auto divide-y divide-slate-100 no-scrollbar">
                            ${references.map(r => `
                                <div onclick="selectRef('${r.id}')" 
                                     class="p-4 cursor-pointer transition-all hover:bg-white active:scale-95 group ${selectedRefId === r.id || (!selectedRefId && r.id === currentRef.id) ? 'bg-white border-l-4 border-l-indigo-600 shadow-sm z-10' : 'border-l-4 border-l-transparent'}">
                                    <div class="flex justify-between items-center mb-1">
                                        <span class="text-[9px] font-black uppercase tracking-widest ${r.status === 'invalid' ? 'text-red-500' : 'text-indigo-600'}">${r.s_head}</span>
                                        <i data-lucide="chevron-right" class="w-3 h-3 text-slate-300 group-hover:text-indigo-600 transition-colors"></i>
                                    </div>
                                    <h6 class="text-sm font-bold text-slate-800 line-clamp-1">${r.t_head}</h6>
                                    <p class="text-[10px] text-slate-400 mt-1 uppercase tracking-tighter">${r.area} Reference</p>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                    <div class="flex-1 p-10 flex flex-col overflow-y-auto no-scrollbar">
                        <div class="mb-10">
                            <div class="flex items-center gap-3 mb-4">
                                <span class="px-3 py-1 bg-indigo-50 text-indigo-600 rounded-full text-[10px] font-black uppercase tracking-widest">Detail View</span>
                                <span class="px-3 py-1 ${currentRef.status === 'valid' ? 'bg-emerald-50 text-emerald-600' : 'bg-red-50 text-red-600'} rounded-full text-[10px] font-black uppercase tracking-widest">${currentRef.status}</span>
                            </div>
                            <h3 class="text-4xl font-black text-slate-900 outfit leading-tight mb-2">${currentRef.s_head} <i data-lucide="arrow-right" class="inline w-6 h-6 mx-2 text-indigo-400"></i> ${currentRef.t_head}</h3>
                            <p class="text-slate-500 font-medium">${currentRef.area} alignment check | Status: ${currentRef.status.toUpperCase()}</p>
                        </div>
                        <div class="grid grid-cols-1 gap-6 mb-10">
                            <div class="bg-indigo-50/30 rounded-2xl p-6 border border-indigo-100 relative">
                                <span class="text-[10px] font-black uppercase text-indigo-400 block mb-3">Context in Source</span>
                                <p class="text-lg font-medium text-slate-800 leading-relaxed italic border-l-4 border-indigo-500 pl-4">
                                    "${currentRef.s_text}"
                                </p>
                            </div>
                            <div class="bg-slate-900 rounded-2xl p-6 shadow-xl">
                                <div class="flex items-center justify-between mb-4">
                                    <span class="text-[10px] font-black uppercase text-slate-500 block">Analysis Logic</span>
                                    <i data-lucide="cpu" class="w-4 h-4 text-indigo-400"></i>
                                </div>
                                <p class="text-slate-300 text-sm font-medium leading-relaxed">
                                    ${currentRef.status === 'valid' ? 'The system successfully mapped this source citation to the target section in the subordinate document. Verbatim matching confirms the relationship is substantively correct.' : currentRef.reason}
                                </p>
                            </div>
                        </div>
                        <div class="mt-auto pt-8 border-t border-slate-100 flex items-center justify-between">
                            <div class="flex items-center gap-6">
                                <button class="flex items-center gap-2 text-slate-400 hover:text-indigo-600 font-bold transition-all text-sm uppercase tracking-widest"><i data-lucide="eye" class="w-4 h-4"></i> Source</button>
                                <button class="flex items-center gap-2 text-slate-400 hover:text-indigo-600 font-bold transition-all text-sm uppercase tracking-widest"><i data-lucide="eye" class="w-4 h-4"></i> Target</button>
                            </div>
                            <button class="bg-indigo-600 text-white px-8 py-3 rounded-xl font-black uppercase tracking-widest text-xs hover:bg-indigo-700 shadow-lg shadow-indigo-100 flex items-center gap-3 active:scale-95 transition-all">
                                Open Inspector <i data-lucide="maximize" class="w-4 h-4"></i>
                            </button>
                        </div>
                    </div>
                </div>
            `;
            }

            function renderPivotMatrix(container) {
                const targets = Array.from(new Set(references.map(r => r.t_head)));
                const sources = Array.from(new Set(references.map(r => r.s_head)));

                container.innerHTML = `
                <div class="h-full flex items-center justify-center p-4">
                    <div class="bg-white rounded-3xl border border-slate-200 shadow-2xl overflow-hidden max-w-full">
                        <table class="border-collapse">
                            <thead>
                                <tr class="bg-slate-50 border-b border-slate-200">
                                    <th class="p-6 border-r border-slate-200"></th>
                                    ${targets.map(t => `<th class="p-4 text-[10px] font-black text-slate-900 uppercase tracking-tight text-center whitespace-nowrap min-w-[100px]">${t}</th>`).join('')}
                                </tr>
                            </thead>
                            <tbody>
                                ${sources.map(s => `
                                    <tr class="border-b border-slate-100 hover:bg-slate-50 transition-colors">
                                        <td class="p-4 border-r border-slate-200 text-xs font-black text-indigo-600 uppercase tracking-widest whitespace-nowrap">${s}</td>
                                        ${targets.map(t => {
                    const matches = references.filter(r => r.s_head === s && r.t_head === t);
                    const hasLink = matches.length > 0;
                    const isSelected = selectedSource === s && selectedTarget === t;
                    const isInvalid = matches.some(m => m.status === 'invalid');
                    return `
                                                <td class="p-0 text-center">
                                                    <div class="flex items-center justify-center h-16 w-full relative group">
                                                        ${hasLink ? `
                                                            <div onclick="selectSource('${s}'); selectTarget('${t}')" 
                                                                 class="w-8 h-8 rounded-lg shadow-sm flex items-center justify-center cursor-pointer transition-all group-hover:scale-125 ${isSelected ? 'ring-4 ring-indigo-200 scale-110 ' + (isInvalid ? 'bg-red-600' : 'bg-indigo-700') : (isInvalid ? 'bg-red-500' : 'bg-indigo-600')}">
                                                                <span class="text-[10px] font-bold text-white">${matches.length}</span>
                                                            </div>
                                                        ` : '<div class="w-1.5 h-1.5 bg-slate-200 rounded-full"></div>'}
                                                    </div>
                                                </td>
                                            `;
                }).join('')}
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>
                </div>
            `;
            }

            // --- STUBS ---
            function renderAccordionDensity(container) {
                const sectionsWithRefs = [
                    { id: 's1', name: 'Section 1: Definitions', refs: references.filter(r => ['r4', 'r8'].includes(r.id)) },
                    { id: 's2', name: 'Section 2: Scope', refs: references.filter(r => ['r12'].includes(r.id)) },
                    { id: 's3', name: 'Section 3: Fees', refs: references.filter(r => ['r5'].includes(r.id)) },
                    { id: 's4', name: 'Section 4: Licensing', refs: references.filter(r => ['r1', 'r2', 'r9', 'r11'].includes(r.id)) },
                    { id: 's5', name: 'Section 5: Performance', refs: references.filter(r => ['r3'].includes(r.id)) },
                    { id: 's6', name: 'Section 15: Compliance', refs: references.filter(r => ['r10'].includes(r.id)) }
                ];

                container.innerHTML = `
                <div class="h-full overflow-y-auto p-4 space-y-4 max-w-3xl mx-auto no-scrollbar">
                    ${sectionsWithRefs.map(s => `
                        <div class="bg-white rounded-2xl border border-slate-200 overflow-hidden shadow-sm transition-all hover:shadow-md">
                            <div class="p-4 bg-slate-50 flex items-center justify-between border-b border-slate-200 cursor-pointer group" onclick="this.nextElementSibling.classList.toggle('hidden')">
                                <div class="flex items-center gap-3">
                                    <h4 class="text-xs font-black text-slate-800 uppercase tracking-wider outfit">${s.name}</h4>
                                    <span class="bg-indigo-100 text-indigo-700 text-[10px] px-2 py-0.5 rounded-full font-bold">${s.refs.length} References</span>
                                </div>
                                <i data-lucide="chevron-down" class="w-4 h-4 text-slate-400 group-hover:text-indigo-600 transition-colors"></i>
                            </div>
                            <div class="p-2 space-y-1">
                                ${s.refs.length === 0 ? '<p class="p-4 text-[10px] text-slate-400 font-medium text-center uppercase tracking-widest">No references in this block</p>' : s.refs.map(r => `
                                    <div onclick="selectRef('${r.id}')" class="flex items-center justify-between p-3 hover:bg-slate-50 rounded-xl transition-colors group cursor-pointer border border-transparent hover:border-slate-100">
                                        <div class="flex items-center gap-4 flex-1">
                                            <div class="w-2 h-2 rounded-full ${r.status === 'valid' ? 'bg-emerald-500 shadow-[0_0_8px_rgba(16,185,129,0.4)]' : 'bg-red-500 shadow-[0_0_8px_rgba(239,68,68,0.4)]'}"></div>
                                            <p class="text-sm font-medium text-slate-600 truncate max-w-[400px]">"${r.s_text}"</p>
                                        </div>
                                        <div class="flex items-center gap-3">
                                            <i data-lucide="arrow-right" class="w-3 h-3 text-slate-300"></i>
                                            <span class="text-[10px] font-black text-slate-900 bg-white border border-slate-200 px-2 py-1 rounded-md shadow-sm uppercase outfit tracking-tighter">${r.t_head}</span>
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    `).join('')}
                </div>
            `;
                lucide.createIcons();
            }

            function renderPillStream(container) {
                const distinctAreas = Array.from(new Set(references.map(r => r.area)));
                container.innerHTML = `
                <div class="h-full overflow-y-auto p-4 flex flex-col gap-10 max-w-4xl mx-auto no-scrollbar">
                    ${distinctAreas.map(area => `
                        <div>
                            <div class="flex items-center gap-3 mb-4">
                                <h4 class="text-[10px] font-black uppercase text-indigo-400 tracking-[0.2em] whitespace-nowrap">${area} WORKFLOW</h4>
                                <div class="h-px w-full bg-slate-100"></div>
                            </div>
                            <div class="flex flex-wrap gap-3">
                                ${references.filter(r => r.area === area).map(r => `
                                    <div onclick="selectRef('${r.id}')" 
                                         class="flex items-center gap-3 px-4 py-2 bg-white border border-slate-200 rounded-full shadow-sm hover:border-indigo-500 hover:shadow-indigo-100 transition-all cursor-pointer group active:scale-95">
                                        <span class="text-[10px] font-black text-indigo-600 outfit uppercase tracking-tighter">${r.s_head}</span>
                                        <i data-lucide="link" class="w-3 h-3 text-slate-300 group-hover:text-indigo-400"></i>
                                        <span class="text-[10px] font-bold text-slate-900 outfit uppercase tracking-tight">${r.t_head}</span>
                                        <span class="w-1.5 h-1.5 rounded-full ${r.status === 'valid' ? 'bg-emerald-500' : 'bg-red-500 animate-pulse'}"></span>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    `).join('')}
                </div>
            `;
                lucide.createIcons();
            }

            function renderDrillCards(container) {
                container.innerHTML = `
                <div class="h-full overflow-y-auto p-4 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 no-scrollbar pb-24">
                    ${references.map(r => `
                        <div class="bg-white rounded-[2rem] p-6 border border-slate-200 shadow-sm hover:shadow-2xl hover:-translate-y-1 transition-all group flex flex-col justify-between cursor-pointer relative overflow-hidden" onclick="selectRef('${r.id}')">
                            ${r.status === 'invalid' ? '<div class="absolute top-0 right-0 w-24 h-24 bg-red-50 transform rotate-45 translate-x-12 -translate-y-12"></div>' : ''}
                            <div>
                                <div class="flex justify-between items-start mb-6">
                                    <div class="p-3 bg-slate-50 rounded-2xl text-slate-400 group-hover:bg-indigo-600 group-hover:text-white transition-all duration-300 shadow-inner">
                                        <i data-lucide="${r.status === 'valid' ? 'link-2' : 'alert-circle'}" class="w-5 h-5"></i>
                                    </div>
                                    <div class="flex flex-col items-end">
                                        <span class="text-[8px] font-black uppercase text-slate-400 mb-1 tracking-widest">${r.area}</span>
                                        <span class="text-[10px] font-black uppercase py-1 px-3 rounded-full shadow-sm ${r.status === 'valid' ? 'bg-emerald-50 text-emerald-600 border border-emerald-100' : 'bg-red-50 text-red-600 border border-red-100'}">
                                            ${r.status}
                                        </span>
                                    </div>
                                </div>
                                <div class="mb-4">
                                    <h5 class="text-xs font-black text-indigo-600 uppercase tracking-widest mb-1">${r.s_head}</h5>
                                    <h4 class="text-lg font-bold text-slate-900 outfit line-clamp-1">Refers to ${r.t_head}</h4>
                                </div>
                                <p class="text-xs text-slate-500 font-medium leading-relaxed line-clamp-3 italic mb-4 bg-slate-50 p-3 rounded-xl border border-dashed border-slate-200">
                                    "${r.s_text}"
                                </p>
                            </div>
                            <div class="pt-4 border-t border-slate-50 flex items-center justify-between">
                                <span class="text-[10px] font-bold text-slate-400 uppercase tracking-tighter">Click for evidence</span>
                                <div class="w-8 h-8 rounded-full bg-slate-50 flex items-center justify-center text-slate-400 group-hover:bg-indigo-50 group-hover:text-indigo-600 transition-colors">
                                    <i data-lucide="arrow-up-right" class="w-4 h-4"></i>
                                </div>
                            </div>
                        </div>
                    `).join('')}
                </div>
            `;
                lucide.createIcons();
            }

            function renderNexusRibbon(container) {
                const leftRefs = references.slice(0, 6);
                const rightRefs = references.slice(6, 12);

                container.innerHTML = `
                <div class="h-full flex items-center justify-center p-4 overflow-hidden">
                    <div class="w-full max-w-5xl flex items-stretch gap-0 relative">
                        <!-- Left Wing -->
                        <div class="flex-1 flex flex-col justify-center gap-4 py-10 pr-12">
                            ${leftRefs.map(r => `
                                <div onclick="selectRef('${r.id}')" class="bg-white p-3 rounded-xl border border-slate-200 shadow-sm text-right relative group hover:scale-105 transition-all cursor-pointer">
                                    <span class="text-[10px] font-black text-indigo-600 block mb-1 uppercase tracking-tighter">${r.s_head}</span>
                                    <p class="text-xs font-bold text-slate-900 line-clamp-1">${r.t_head}</p>
                                    <div class="absolute top-1/2 -right-12 w-12 h-px bg-slate-200 group-hover:bg-indigo-400"></div>
                                </div>
                            `).join('')}
                        </div>

                        <!-- Central Nexus -->
                        <div class="w-1 bg-gradient-to-b from-indigo-50 via-indigo-500 to-indigo-50 relative flex items-center justify-center">
                            <div class="w-12 h-12 bg-white rounded-full border-4 border-indigo-500 shadow-[0_0_20px_rgba(99,102,241,0.3)] flex items-center justify-center z-10 animate-pulse">
                                <i data-lucide="zap" class="w-6 h-6 text-indigo-600"></i>
                            </div>
                        </div>

                        <!-- Right Wing -->
                        <div class="flex-1 flex flex-col justify-center gap-4 py-10 pl-12">
                            ${rightRefs.map(r => `
                                <div onclick="selectRef('${r.id}')" class="bg-white p-3 rounded-xl border border-slate-200 shadow-sm text-left relative group hover:scale-105 transition-all cursor-pointer">
                                    <span class="text-[10px] font-black text-indigo-600 block mb-1 uppercase tracking-tighter">${r.s_head}</span>
                                    <p class="text-xs font-bold text-slate-900 line-clamp-1">${r.t_head}</p>
                                    <div class="absolute top-1/2 -left-12 w-12 h-px bg-slate-200 group-hover:bg-indigo-400"></div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                </div>
            `;
                lucide.createIcons();
            }

            function renderInterleaved(container) {
                container.innerHTML = `
                <div class="h-full overflow-y-auto px-10 py-4 space-y-12 max-w-4xl mx-auto no-scrollbar pb-32">
                    <div class="flex items-center gap-4 mb-4 sticky top-0 bg-slate-50/90 backdrop-blur-sm p-4 z-10 border-b border-slate-200 rounded-b-2xl">
                        <i data-lucide="file-text" class="w-5 h-5 text-indigo-600"></i>
                        <h4 class="text-sm font-black text-slate-900 uppercase tracking-widest outfit">Document Comparison Flow</h4>
                    </div>
                    ${references.slice(0, 5).map(r => `
                        <div class="relative group">
                            <!-- Visual bridge -->
                            <div class="absolute left-1/2 top-4 bottom-0 w-0.5 bg-slate-100 -translate-x-1/2 -z-10 group-hover:bg-indigo-100 transition-colors"></div>
                            
                            <div class="grid grid-cols-2 gap-12 items-start">
                                <!-- Source Item -->
                                <div class="bg-white p-5 rounded-2xl border border-slate-200 shadow-sm hover:shadow-md transition-all relative">
                                    <div class="flex items-center gap-2 mb-3">
                                        <div class="w-2 h-2 rounded-full bg-indigo-500"></div>
                                        <span class="text-[10px] font-black text-slate-400 uppercase tracking-widest">Source: ${r.s_head}</span>
                                    </div>
                                    <p class="text-sm font-medium text-slate-700 leading-relaxed italic">
                                        "${r.s_text}"
                                    </p>
                                </div>

                                <!-- Target Item -->
                                <div class="bg-white p-5 rounded-2xl border-2 border-indigo-100 shadow-lg relative translate-y-8 hover:translate-y-6 transition-transform">
                                    <div class="absolute -left-6 top-4 w-6 h-px bg-indigo-200"></div>
                                    <div class="flex items-center justify-between mb-3">
                                        <div class="flex items-center gap-2">
                                            <div class="w-2 h-2 rounded-full ${r.status === 'valid' ? 'bg-emerald-500' : 'bg-red-500'}"></div>
                                            <span class="text-[10px] font-black text-indigo-600 uppercase tracking-widest">${r.t_head}</span>
                                        </div>
                                        <span class="text-[8px] font-bold bg-indigo-50 text-indigo-600 px-1.5 py-0.5 rounded uppercase tracking-tighter">CLAUSE ${r.t_clause}</span>
                                    </div>
                                    <p class="text-[11px] text-slate-500 font-medium leading-relaxed italic">
                                        [Target metadata and verbatim verification logic would appear here in the final implementation.]
                                    </p>
                                    <div class="mt-4 flex justify-end">
                                        <button class="text-[10px] font-black text-indigo-500 uppercase flex items-center gap-1 group/btn">
                                            View Target <i data-lucide="arrow-right" class="w-3 h-3 group-hover/btn:translate-x-1 transition-transform"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `).join('')}
                </div>
            `;
                lucide.createIcons();
            }

            function renderNodeGraph(container) {
                const nodes = [];
                const links = [];
                const sources = Array.from(new Set(references.map(r => r.s_head)));
                const targets = Array.from(new Set(references.map(r => r.t_head)));

                sources.forEach((s, i) => nodes.push({ id: s, type: 'source', x: 200, y: 100 + i * 80 }));
                targets.forEach((t, i) => nodes.push({ id: t, type: 'target', x: 600, y: 100 + i * 80 }));

                references.forEach(r => {
                    links.push({ source: r.s_head, target: r.t_head, status: r.status });
                });

                container.innerHTML = `
                <div class="h-full flex flex-col p-4 bg-slate-900 rounded-3xl overflow-hidden relative">
                    <div class="absolute top-6 left-6 z-10">
                        <h4 class="text-[10px] font-black text-indigo-400 uppercase tracking-[0.2em] mb-1">Topology View</h4>
                        <p class="text-xs text-slate-500 font-medium">Visualizing document inter-dependency</p>
                    </div>
                    
                    <svg class="flex-1 w-full h-full" id="graph-svg">
                        <defs>
                            <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="15" refY="3.5" orient="auto">
                                <polygon points="0 0, 10 3.5, 0 7" fill="#475569" />
                            </marker>
                        </defs>
                        ${links.map(l => {
                    const sNode = nodes.find(n => n.id === l.source);
                    const tNode = nodes.find(n => n.id === l.target);
                    return `
                                <line x1="${sNode.x}" y1="${sNode.y}" x2="${tNode.x}" y2="${tNode.y}" 
                                      class="stroke-slate-700" stroke-width="1.5" marker-end="url(#arrowhead)" />
                            `;
                }).join('')}
                        ${nodes.map(n => `
                            <g class="cursor-pointer group" onclick="selectSource('${n.id}')">
                                <circle cx="${n.x}" cy="${n.y}" r="25" class="${n.type === 'source' ? 'fill-indigo-600' : 'fill-slate-800'} stroke-slate-700" stroke-width="2" />
                                <text x="${n.x}" y="${n.y + 45}" text-anchor="middle" class="fill-slate-400 text-[9px] font-black uppercase outfit">${n.id}</text>
                                <i data-lucide="${n.type === 'source' ? 'file-text' : 'target'}" class="w-4 h-4 text-white" x="${n.x - 8}" y="${n.y - 8}"></i>
                            </g>
                        `).join('')}
                    </svg>

                    <div class="absolute bottom-6 right-6 flex gap-4">
                        <div class="flex items-center gap-2"><span class="w-3 h-3 rounded-full bg-indigo-600"></span><span class="text-[10px] text-slate-400 uppercase font-bold">Source</span></div>
                        <div class="flex items-center gap-2"><span class="w-3 h-3 rounded-full bg-slate-800"></span><span class="text-[10px] text-slate-400 uppercase font-bold">Target</span></div>
                    </div>
                </div>
            `;
                // Simplified lucide icon injection for SVG is tricky via innerHTML, we'll just use colors/shapes for demo nodes
            }

            function renderCommandPalette(container) {
                const query = '';
                container.innerHTML = `
                <div class="h-full flex items-center justify-center p-4">
                    <div class="w-full max-w-2xl bg-white rounded-3xl shadow-2xl border border-slate-200 overflow-hidden flex flex-col h-[500px]">
                        <div class="p-6 border-b border-slate-100 flex items-center gap-4 bg-slate-50/50">
                            <i data-lucide="search" class="w-6 h-6 text-indigo-500"></i>
                            <input type="text" id="cmd-search" placeholder="Type to search references (e.g. 'Liability', 'Section 4.1')..." 
                                class="flex-1 bg-transparent border-none text-lg font-medium focus:ring-0 placeholder-slate-400"
                                oninput="filterCmdList(this.value)">
                            <div class="flex items-center gap-1.5 px-2 py-1 bg-white border border-slate-200 rounded-lg text-[10px] font-black text-slate-400 uppercase">
                                <span class="px-1">ESC</span> to close
                            </div>
                        </div>
                        
                        <div class="flex-1 overflow-y-auto p-4 space-y-2 no-scrollbar" id="cmd-results-list">
                            ${references.map(r => `
                                <div onclick="selectRef('${r.id}'); switchLayout('master-detail')" 
                                     class="p-4 rounded-2xl flex items-center justify-between group cursor-pointer hover:bg-indigo-600 hover:text-white transition-all">
                                    <div class="flex items-center gap-4">
                                        <div class="w-10 h-10 rounded-xl bg-slate-100 group-hover:bg-white/20 flex items-center justify-center transition-colors">
                                            <i data-lucide="link-2" class="w-5 h-5 text-slate-400 group-hover:text-white"></i>
                                        </div>
                                        <div>
                                            <div class="flex items-center gap-2 mb-0.5">
                                                <span class="text-[10px] font-black uppercase tracking-widest text-indigo-500 group-hover:text-indigo-200">${r.s_head}</span>
                                                <span class="w-1 h-1 rounded-full bg-slate-300 group-hover:bg-white/40"></span>
                                                <span class="text-[10px] font-black uppercase tracking-widest text-slate-400 group-hover:text-white/60">${r.area}</span>
                                            </div>
                                            <p class="text-sm font-bold text-slate-800 group-hover:text-white">Refers to ${r.t_head}</p>
                                        </div>
                                    </div>
                                    <i data-lucide="arrow-right" class="w-4 h-4 opacity-0 group-hover:opacity-100 transition-opacity"></i>
                                </div>
                            `).join('')}
                        </div>

                        <div class="p-4 border-t border-slate-100 bg-slate-50 flex items-center justify-between text-[10px] font-black text-slate-400 uppercase tracking-widest">
                            <div class="flex gap-4">
                                <span><i data-lucide="arrow-up-down" class="inline w-3 h-3 mr-1"></i> Navigate</span>
                                <span><i data-lucide="corner-down-left" class="inline w-3 h-3 mr-1"></i> Select</span>
                            </div>
                            <span>${references.length} Total References</span>
                        </div>
                    </div>
                </div>
            `;
                lucide.createIcons();
                setTimeout(() => document.getElementById('cmd-search').focus(), 100);
            }

            window.filterCmdList = function (val) {
                const list = document.getElementById('cmd-results-list');
                const search = val.toLowerCase();
                const filtered = references.filter(r =>
                    r.s_head.toLowerCase().includes(search) ||
                    r.t_head.toLowerCase().includes(search) ||
                    r.s_text.toLowerCase().includes(search) ||
                    r.area.toLowerCase().includes(search)
                );

                list.innerHTML = filtered.map(r => `
                <div onclick="selectRef('${r.id}'); switchLayout('master-detail')" 
                     class="p-4 rounded-2xl flex items-center justify-between group cursor-pointer hover:bg-indigo-600 hover:text-white transition-all">
                    <div class="flex items-center gap-4">
                        <div class="w-10 h-10 rounded-xl bg-slate-100 group-hover:bg-white/20 flex items-center justify-center transition-colors">
                            <i data-lucide="link-2" class="w-5 h-5 text-slate-400 group-hover:text-white"></i>
                        </div>
                        <div>
                            <div class="flex items-center gap-2 mb-0.5">
                                <span class="text-[10px] font-black uppercase tracking-widest text-indigo-500 group-hover:text-indigo-200">${r.s_head}</span>
                                <span class="w-1 h-1 rounded-full bg-slate-300 group-hover:bg-white/40"></span>
                                <span class="text-[10px] font-black uppercase tracking-widest text-slate-400 group-hover:text-white/60">${r.area}</span>
                            </div>
                            <p class="text-sm font-bold text-slate-800 group-hover:text-white">Refers to ${r.t_head}</p>
                        </div>
                    </div>
                    <i data-lucide="arrow-right" class="w-4 h-4 opacity-0 group-hover:opacity-100 transition-opacity"></i>
                </div>
            `).join('');
                lucide.createIcons();
            }

            window.addEventListener('load', init);
        </script>
</body>

</html>
</body>

</html>